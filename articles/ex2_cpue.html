<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting to an additional CPUE survey â€¢ rema</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting to an additional CPUE survey">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rema</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ex1_basics.html">REMA basics</a></li>
    <li><a class="dropdown-item" href="../articles/ex2_cpue.html">Fitting to an additional CPUE survey</a></li>
    <li><a class="dropdown-item" href="../articles/ex3_zeros.html">Strategies for handling zero biomass observations</a></li>
    <li><a class="dropdown-item" href="../articles/ex4_model_validation.html">REMA model validation</a></li>
    <li><a class="dropdown-item" href="../articles/rema_equations.html">REMA model equations</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JaneSullivan-NOAA/rema/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting to an additional CPUE survey</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JaneSullivan-NOAA/rema/blob/main/vignettes/ex2_cpue.Rmd" class="external-link"><code>vignettes/ex2_cpue.Rmd</code></a></small>
      <div class="d-none name"><code>ex2_cpue.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JaneSullivan-NOAA/rema" class="external-link">rema</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span> <span class="co"># install.packages('cowplot') # helpful plotting utilities</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/background_grid.html" class="external-link">background_grid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/panel_border.html" class="external-link">panel_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This vignette demonstrates how to fit the REMA model to a biomass
survey and auxiliary CPUE index. We show the transition from the
formerly used ADMB REMA model, which was determined to have invalid
statistical inference due to an error in the specification of the
<code>SEPARABLE_FUNCTION</code>. We fit the correctly-specified version
of the same model using <code>rema</code> and discuss differences in the
results and trade-offs between observation and process error (PE)
variance. Next, we introduce a model that estimates additional
observation error for the biomass and CPUE surveys and compare these
models using Akaike Information Criteria (AIC). Finally, we demonstrate
how <code>rema</code> can be used to compare apportionment results from
alternative models.</p>
<p>This example is based on GOA shortraker rockfish biomass estimates
from the GOA bottom trawl survey and Relative Population Weights (RPWs)
from the NMFS longline survey. The model is stratified by management
area, fitting to data in the eastern GOA (EGOA), central GOA (CGOA), and
western GOA (WGOA). The original model estimates a single, shared PE
parameter across all strata but estimates unique scaling parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
for each strata. It applies a likelihood weight of 0.5 on the CPUE
survey component of the likelihood. We have replicated this structure in
the TMB model fit using <code>rema</code>.</p>
<div class="section level2">
<h2 id="model-1-fit-to-the-biomass-and-cpue-survey-through-the-estimation-of-a-scaling-parameter-q">Model 1: Fit to the biomass and CPUE survey through the estimation
of a scaling parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#model-1-fit-to-the-biomass-and-cpue-survey-through-the-estimation-of-a-scaling-parameter-q"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in the data using the report file from the original ADMB model</span></span>
<span><span class="va">admb_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_admb_re.html">read_admb_re</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">'goasr_rwout.rep'</span>,</span>
<span>                        biomass_strata_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CGOA'</span>, <span class="st">'EGOA'</span>, <span class="st">'WGOA'</span><span class="op">)</span>,</span>
<span>                        cpue_strata_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CGOA'</span>, <span class="st">'EGOA'</span>, <span class="st">'WGOA'</span><span class="op">)</span>,</span>
<span>                        model_name <span class="op">=</span> <span class="st">'M0: ADMB status quo (invalid)'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_rema_input.html">prepare_rema_input</a></span><span class="op">(</span>model_name <span class="op">=</span> <span class="st">'M1: TMB status quo'</span>,</span>
<span>                            <span class="co"># fit to both biomass and CPUE survey data</span></span>
<span>                            multi_survey <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                            admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                            <span class="co"># the RPW index is summable across strata</span></span>
<span>                            sum_cpue_index <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            <span class="co"># likelihood weight </span></span>
<span>                            wt_cpue <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                            <span class="co"># one process error parameters (log_PE) estimated</span></span>
<span>                            PE_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_PE_biomass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># three scaling parameters (log_q) estimated, indexed as</span></span>
<span>                            <span class="co"># follows for each biomass survey stratum:</span></span>
<span>                            q_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_biomass_cpue_strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_rema.html">fit_rema</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model runtime: 0.1 seconds </span></span>
<span><span class="co">#&gt; stats::nlminb thinks the model has converged: mod$opt$convergence == 0</span></span>
<span><span class="co">#&gt; Maximum gradient component: 4.12e-04 </span></span>
<span><span class="co">#&gt; Max gradient parameter: log_PE </span></span>
<span><span class="co">#&gt; TMB:sdreport() was performed successfully for this model</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_rema.html">tidy_rema</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">parameter_estimates</span></span>
<span><span class="co">#&gt;           model_name           parameter  estimate    std_err       lci</span></span>
<span><span class="co">#&gt; 1 M1: TMB status quo       process_error 0.1696964 0.03914612 0.1079729</span></span>
<span><span class="co">#&gt; 2 M1: TMB status quo scaling_parameter_q 0.4123880 0.04474590 0.3333857</span></span>
<span><span class="co">#&gt; 3 M1: TMB status quo scaling_parameter_q 1.2127809 0.10874662 1.0173198</span></span>
<span><span class="co">#&gt; 4 M1: TMB status quo scaling_parameter_q 2.1164194 0.30469400 1.5960887</span></span>
<span><span class="co">#&gt;         uci</span></span>
<span><span class="co">#&gt; 1 0.2667047</span></span>
<span><span class="co">#&gt; 2 0.5101115</span></span>
<span><span class="co">#&gt; 3 1.4457965</span></span>
<span><span class="co">#&gt; 4 2.8063798</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_rema.html">plot_rema</a></span><span class="op">(</span><span class="va">output</span>, biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>, cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span>,</span>
<span>                   <span class="va">plots</span><span class="op">$</span><span class="va">cpue_by_strata</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/status-quo-1.png" width="816"></p>
<div class="section level3">
<h3 id="a-comparison-of-the-admb-and-tmb-models">A comparison of the ADMB and TMB models<a class="anchor" aria-label="anchor" href="#a-comparison-of-the-admb-and-tmb-models"></a>
</h3>
<p>When we compare the fits between the status quo ADMB model and the
identically structured but correctly-specified TMB model, we see large
differences in model predictions. In particular the PE variance are very
different, with the ADMB model producing a PE that is more than seven
times the PE in the TMB model: M0: ADMB status quo (invalid) PE = 0.0233
M1: TMB status quo PE = 0.1697</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_rema_models.html">compare_rema_models</a></span><span class="op">(</span>rema_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>,</span>
<span>                               admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                               biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>,</span>
<span>                               cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span><span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/compare-status-quo-1.png" width="816"></p>
</div>
<div class="section level3">
<h3 id="model-2-estimating-additional-observation-error-in-the-two-surveys">Model 2: Estimating additional observation error in the two
surveys<a class="anchor" aria-label="anchor" href="#model-2-estimating-additional-observation-error-in-the-two-surveys"></a>
</h3>
<p>The outcome in the TMB model is problematic because we would not
expect shortraker rockfish, a notably long-lived species, to exhibit
such extreme inter-annual variability. In part, this finding is
attributed to relatively low observation error in the survey data. In
the following section we explore an alternative model that estimates
additional biomass and CPUE survey observation error. We then use AIC to
conduct model selection.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">input2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_rema_input.html">prepare_rema_input</a></span><span class="op">(</span>model_name <span class="op">=</span> <span class="st">'M2: TMB extra obs error'</span>,</span>
<span>                            <span class="co"># fit to both biomass and CPUE survey data</span></span>
<span>                            multi_survey <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                            admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                            <span class="co"># the RPW index is summable across strata</span></span>
<span>                            sum_cpue_index <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            <span class="co"># likelihood weight </span></span>
<span>                            wt_cpue <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                            <span class="co"># one process error parameters (log_PE) estimated</span></span>
<span>                            PE_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_PE_biomass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># three scaling parameters (log_q) estimated, indexed as</span></span>
<span>                            <span class="co"># follows for each biomass survey stratum:</span></span>
<span>                            q_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_biomass_cpue_strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># estimate additional obs error on the biomass</span></span>
<span>                            <span class="co"># survey (one additional CV shared across all 3</span></span>
<span>                            <span class="co"># strata)</span></span>
<span>                            extra_biomass_cv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>assumption <span class="op">=</span> <span class="st">'extra_cv'</span><span class="op">)</span>,</span>
<span>                            <span class="co"># estimate additional obs error on the CPUE</span></span>
<span>                            <span class="co"># survey (one additional CV shared across all 3</span></span>
<span>                            <span class="co"># strata)</span></span>
<span>                            extra_cpue_cv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>assumption <span class="op">=</span> <span class="st">'extra_cv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_rema.html">fit_rema</a></span><span class="op">(</span><span class="va">input2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model runtime: 0.1 seconds </span></span>
<span><span class="co">#&gt; stats::nlminb thinks the model has converged: mod$opt$convergence == 0</span></span>
<span><span class="co">#&gt; Maximum gradient component: 1.58e-05 </span></span>
<span><span class="co">#&gt; Max gradient parameter: log_q </span></span>
<span><span class="co">#&gt; TMB:sdreport() was performed successfully for this model</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_rema.html">tidy_rema</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<p>The following figure shows the fits to the data as before; however,
here we used the <code><a href="../reference/tidy_extra_cv.html">tidy_extra_cv()</a></code> and
<code><a href="../reference/plot_extra_cv.html">plot_extra_cv()</a></code> functions to obtain the total 95%
confidence intervals for survey biomass or CPUE observations (i.e.,
fixed + estimated observation error). Note that the 95% confidence
intervals of the observations (i.e.,
<code>obs_lci</code>/<code>obs_uci</code> and
<code>tot_obs_lci</code>/<code>tot_obs_uci</code> in
<code>output$biomass_by_strata</code> and
<code>output$cpue_by_strata</code> are based on the assumption of
normality in log-space; therefore, they are asymmetric on the arithmetic
scale.</p>
<p>In the figure below, the error bars around the survey observations
show the 95% confidence intervals based on the assumed design-based
estimates (in bold with whiskers) and the 95% confidence intervals based
on the total observation error (design-based estimates of CV +
additional estimated CV; no whiskers).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adds new columns with total observation error and 95% confidence intervals to</span></span>
<span><span class="co"># the biomass_by_strata and cpue_by_strata</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_extra_cv.html">tidy_extra_cv</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span><span class="va">cvplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_extra_cv.html">plot_extra_cv</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">cvplots</span><span class="op">$</span><span class="va">biomass_by_strata</span>,</span>
<span>                   <span class="va">cvplots</span><span class="op">$</span><span class="va">cpue_by_strata</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/plot-extra-sd-1.png" width="816"></p>
</div>
<div class="section level3">
<h3 id="model-comparison">Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"></a>
</h3>
<p>A comparison of the the three models shows that estimation of
additional observation error substantially reduces PE variance,
resulting in a smoother trajectory of biomass predictions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_rema_models.html">compare_rema_models</a></span><span class="op">(</span>rema_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span>,</span>
<span>                               admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                               biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>,</span>
<span>                               cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/compare-new-1.png" width="816"></p>
</div>
<div class="section level3">
<h3 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h3>
<p>Next, we can compare the fits to both biomass and CPUE survey indices
from the alternative TMB models if we remove the <code>admb_re</code>
object from the comparison function as demonstrated below. An
examination of the parameter estimates shows that the M2 (extra
observation error) estimates a much lower PE, approximately 50% of the
M1 PE. Using AIC, we find that M2 has a superior fit to M1 and that
there is statistical support for the additional parameters (note that
this example is intended to be illustrative of the model fitting and
model selection process and is not exhaustive).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_rema_models.html">compare_rema_models</a></span><span class="op">(</span>rema_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span>,</span>
<span>                               biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>,</span>
<span>                               cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>                   <span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">cpue_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.65</span>, <span class="fl">0.35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/compare-new2-1.png" width="816"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">parameter_estimates</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="28%">
<col width="23%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">model_name</th>
<th align="left">parameter</th>
<th align="right">estimate</th>
<th align="right">std_err</th>
<th align="right">lci</th>
<th align="right">uci</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M1: TMB status quo</td>
<td align="left">process_error</td>
<td align="right">0.1696964</td>
<td align="right">0.0391461</td>
<td align="right">0.1079729</td>
<td align="right">0.2667047</td>
</tr>
<tr class="even">
<td align="left">M1: TMB status quo</td>
<td align="left">scaling_parameter_q</td>
<td align="right">0.4123880</td>
<td align="right">0.0447459</td>
<td align="right">0.3333857</td>
<td align="right">0.5101115</td>
</tr>
<tr class="odd">
<td align="left">M1: TMB status quo</td>
<td align="left">scaling_parameter_q</td>
<td align="right">1.2127809</td>
<td align="right">0.1087466</td>
<td align="right">1.0173198</td>
<td align="right">1.4457965</td>
</tr>
<tr class="even">
<td align="left">M1: TMB status quo</td>
<td align="left">scaling_parameter_q</td>
<td align="right">2.1164194</td>
<td align="right">0.3046940</td>
<td align="right">1.5960887</td>
<td align="right">2.8063798</td>
</tr>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="left">process_error</td>
<td align="right">0.0811987</td>
<td align="right">0.0414474</td>
<td align="right">0.0298578</td>
<td align="right">0.2208209</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="left">scaling_parameter_q</td>
<td align="right">0.4163631</td>
<td align="right">0.0712154</td>
<td align="right">0.2977702</td>
<td align="right">0.5821878</td>
</tr>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="left">scaling_parameter_q</td>
<td align="right">1.1272648</td>
<td align="right">0.1861890</td>
<td align="right">0.8155188</td>
<td align="right">1.5581810</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="left">scaling_parameter_q</td>
<td align="right">2.0421164</td>
<td align="right">0.3874923</td>
<td align="right">1.4078769</td>
<td align="right">2.9620766</td>
</tr>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="left">extra_biomass_cv</td>
<td align="right">0.5032289</td>
<td align="right">0.1264378</td>
<td align="right">0.3075379</td>
<td align="right">0.8234411</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="left">extra_cpue_cv</td>
<td align="right">0.2544343</td>
<td align="right">0.0612432</td>
<td align="right">0.1587408</td>
<td align="right">0.4078147</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">aic</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="33%">
<col width="26%">
<col width="18%">
<col width="8%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">model_name</th>
<th align="right">objective_function</th>
<th align="right">n_parameters</th>
<th align="right">aic</th>
<th align="right">delta_aic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="right">96.36947</td>
<td align="right">6</td>
<td align="right">204.7</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">M1: TMB status quo</td>
<td align="right">111.37320</td>
<td align="right">4</td>
<td align="right">230.7</td>
<td align="right">26</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="apportionment-results">Apportionment results<a class="anchor" aria-label="anchor" href="#apportionment-results"></a>
</h3>
<p>The proportion of prediction biomass by strata (management area in
this example), is often used for apportionment of Acceptable Biological
Catch estimates. Results from the <code><a href="../reference/compare_rema_models.html">compare_rema_models()</a></code>
function include a table of proportioned biomass by management area for
this purpose.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">proportion_biomass_by_strata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">model_name</th>
<th align="right">year</th>
<th align="right">CGOA</th>
<th align="right">EGOA</th>
<th align="right">WGOA</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M1: TMB status quo</td>
<td align="right">2022</td>
<td align="right">0.3861332</td>
<td align="right">0.5610169</td>
<td align="right">0.0528499</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="right">2022</td>
<td align="right">0.4124545</td>
<td align="right">0.5229923</td>
<td align="right">0.0645532</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare$plots$proportion_biomass_by_strata # optional figure</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jane Sullivan, Laurinne Balstad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
