<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rema">
<title>Fitting to an additional CPUE survey â€¢ rema</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting to an additional CPUE survey">
<meta property="og:description" content="rema">
<meta property="og:image" content="https://afsc-assessments.github.io/rema/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rema</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ex1_basics.html">REMA basics</a>
    <a class="dropdown-item" href="../articles/ex2_cpue.html">Fitting to an additional CPUE survey</a>
    <a class="dropdown-item" href="../articles/ex3_zeros.html">Strategies for handling zero biomass observations</a>
    <a class="dropdown-item" href="../articles/rema_equations.html">REMA model equations</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JaneSullivan-NOAA/rema/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting to an additional CPUE survey</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JaneSullivan-NOAA/rema/blob/HEAD/vignettes/ex2_cpue.Rmd" class="external-link"><code>vignettes/ex2_cpue.Rmd</code></a></small>
      <div class="d-none name"><code>ex2_cpue.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JaneSullivan-NOAA/rema" class="external-link">rema</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span> <span class="co"># install.packages('cowplot') # helpful plotting utilities</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/background_grid.html" class="external-link">background_grid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/panel_border.html" class="external-link">panel_border</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This vignette demonstrates how to fit the REMA model to a biomass
survey and auxiliary CPUE index. We show the transition from the
formerly used ADMB REMA model, which was determined to have invalid
statistical inference due to an error in the specification of the
<code>SEPARABLE_FUNCTION</code>. We fit the correctly-specified version
of the same model using <code>rema</code> and discuss differences in the
results and trade-offs between observation and process error (PE)
variance. Next, we introduce a model that estimates additional
observation error for the biomass and CPUE surveys and compare these
models using Akaike Information Criteria (AIC). Finally, we demonstrate
how <code>rema</code> can be used to compare apportionment results from
alternative models.</p>
<p>This example is based on GOA shortraker rockfish biomass estimates
from the GOA bottom trawl survey and Relative Population Weights (RPWs)
from the NMFS longline survey. The model is stratified by management
area, fitting to data in the eastern GOA (EGOA), central GOA (CGOA), and
western GOA (WGOA). The original model estimates a single, shared PE
parameter across all strata but estimates unique scaling parameters
<span class="math inline">\(q\)</span> for each strata. It applies a
likelihood weight of 0.5 on the CPUE survey component of the likelihood.
We have replicated this structure in the TMB model fit using
<code>rema</code>.</p>
<div class="section level2">
<h2 id="model-1-fit-to-the-biomass-and-cpue-survey-through-the-estimation-of-a-scaling-parameter-q">Model 1: Fit to the biomass and CPUE survey through the estimation
of a scaling parameter <span class="math inline">\(q\)</span><a class="anchor" aria-label="anchor" href="#model-1-fit-to-the-biomass-and-cpue-survey-through-the-estimation-of-a-scaling-parameter-q"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in the data using the report file from the original ADMB model</span></span>
<span><span class="va">admb_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_admb_re.html">read_admb_re</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">'goasr_rwout.rep'</span>,</span>
<span>                        biomass_strata_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CGOA'</span>, <span class="st">'EGOA'</span>, <span class="st">'WGOA'</span><span class="op">)</span>,</span>
<span>                        cpue_strata_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CGOA'</span>, <span class="st">'EGOA'</span>, <span class="st">'WGOA'</span><span class="op">)</span>,</span>
<span>                        model_name <span class="op">=</span> <span class="st">'M0: ADMB status quo (invalid)'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_rema_input.html">prepare_rema_input</a></span><span class="op">(</span>model_name <span class="op">=</span> <span class="st">'M1: TMB status quo'</span>,</span>
<span>                            <span class="co"># fit to both biomass and CPUE survey data</span></span>
<span>                            multi_survey <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                            admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                            <span class="co"># the RPW index is summable across strata</span></span>
<span>                            sum_cpue_index <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            <span class="co"># likelihood weight </span></span>
<span>                            wt_cpue <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                            <span class="co"># one process error parameters (log_PE) estimated</span></span>
<span>                            PE_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_PE_biomass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># three scaling parameters (log_q) estimated, indexed as</span></span>
<span>                            <span class="co"># follows for each biomass survey stratum:</span></span>
<span>                            q_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_biomass_cpue_strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_rema.html">fit_rema</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model runtime: 0.2 seconds </span></span>
<span><span class="co">#&gt; stats::nlminb thinks the model has converged: mod$opt$convergence == 0</span></span>
<span><span class="co">#&gt; Maximum gradient component: 2.26e-04 </span></span>
<span><span class="co">#&gt; Max gradient parameter: log_q </span></span>
<span><span class="co">#&gt; TMB:sdreport() was performed successfully for this model</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_rema.html">tidy_rema</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">parameter_estimates</span></span>
<span><span class="co">#&gt;           model_name           parameter  estimate    std_err       lci</span></span>
<span><span class="co">#&gt; 1 M1: TMB status quo       process_error 0.1696942 0.03914587 0.1079711</span></span>
<span><span class="co">#&gt; 2 M1: TMB status quo scaling_parameter_q 0.4123883 0.04474590 0.3333860</span></span>
<span><span class="co">#&gt; 3 M1: TMB status quo scaling_parameter_q 1.2127879 0.10874712 1.0173260</span></span>
<span><span class="co">#&gt; 4 M1: TMB status quo scaling_parameter_q 2.1164267 0.30469487 1.5960945</span></span>
<span><span class="co">#&gt;         uci</span></span>
<span><span class="co">#&gt; 1 0.2667020</span></span>
<span><span class="co">#&gt; 2 0.5101118</span></span>
<span><span class="co">#&gt; 3 1.4458046</span></span>
<span><span class="co">#&gt; 4 2.8063890</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_rema.html">plot_rema</a></span><span class="op">(</span><span class="va">output</span>, biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>, cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span>,</span>
<span>                   <span class="va">plots</span><span class="op">$</span><span class="va">cpue_by_strata</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/status-quo-1.png" width="816"></p>
<div class="section level3">
<h3 id="a-comparison-of-the-admb-and-tmb-models">A comparison of the ADMB and TMB models<a class="anchor" aria-label="anchor" href="#a-comparison-of-the-admb-and-tmb-models"></a>
</h3>
<p>When we compare the fits between the status quo ADMB model and the
identically structured but correctly-specified TMB model, we see large
differences in model predictions. In particular the PE variance are very
different, with the ADMB model producing a PE that is more than seven
times the PE in the TMB model: M0: ADMB status quo (invalid) PE = 0.0233
M1: TMB status quo PE = 0.1697</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_rema_models.html">compare_rema_models</a></span><span class="op">(</span>rema_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>,</span>
<span>                               admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                               biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>,</span>
<span>                               cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span><span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/compare-status-quo-1.png" width="816"></p>
</div>
<div class="section level3">
<h3 id="model-2-estimating-additional-observation-error-in-the-two-surveys">Model 2: Estimating additional observation error in the two
surveys<a class="anchor" aria-label="anchor" href="#model-2-estimating-additional-observation-error-in-the-two-surveys"></a>
</h3>
<p>The outcome in the TMB model is problematic because we would not
expect shortraker rockfish, a notably long-lived species, to exhibit
such extreme inter-annual variability. In part, this finding is
attributed to relatively low observation error in the survey data. In
the following section we explore an alternative model that estimates
additional biomass and CPUE survey observation error. We then use AIC to
conduct model selection.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">input2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_rema_input.html">prepare_rema_input</a></span><span class="op">(</span>model_name <span class="op">=</span> <span class="st">'M2: TMB extra obs error'</span>,</span>
<span>                            <span class="co"># fit to both biomass and CPUE survey data</span></span>
<span>                            multi_survey <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                            admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                            <span class="co"># the RPW index is summable across strata</span></span>
<span>                            sum_cpue_index <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            <span class="co"># likelihood weight </span></span>
<span>                            wt_cpue <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                            <span class="co"># one process error parameters (log_PE) estimated</span></span>
<span>                            PE_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_PE_biomass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># three scaling parameters (log_q) estimated, indexed as</span></span>
<span>                            <span class="co"># follows for each biomass survey stratum:</span></span>
<span>                            q_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pointer_biomass_cpue_strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># estimate additional obs error on the biomass</span></span>
<span>                            <span class="co"># survey (one additional CV shared across all 3</span></span>
<span>                            <span class="co"># strata)</span></span>
<span>                            extra_biomass_cv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>assumption <span class="op">=</span> <span class="st">'extra_cv'</span><span class="op">)</span>,</span>
<span>                            <span class="co"># estimate additional obs error on the CPUE</span></span>
<span>                            <span class="co"># survey (one additional CV shared across all 3</span></span>
<span>                            <span class="co"># strata)</span></span>
<span>                            extra_cpue_cv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>assumption <span class="op">=</span> <span class="st">'extra_cv'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_rema.html">fit_rema</a></span><span class="op">(</span><span class="va">input2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model runtime: 0.1 seconds </span></span>
<span><span class="co">#&gt; stats::nlminb thinks the model has converged: mod$opt$convergence == 0</span></span>
<span><span class="co">#&gt; Maximum gradient component: 1.03e-05 </span></span>
<span><span class="co">#&gt; Max gradient parameter: log_q </span></span>
<span><span class="co">#&gt; TMB:sdreport() was performed successfully for this model</span></span>
<span><span class="fu"><a href="../reference/tidy_rema.html">tidy_rema</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">$</span><span class="va">parameter_estimates</span></span>
<span><span class="co">#&gt;                model_name           parameter  estimate    std_err       lci</span></span>
<span><span class="co">#&gt; 1 M2: TMB extra obs error       process_error 0.0811985 0.04144752 0.0298576</span></span>
<span><span class="co">#&gt; 2 M2: TMB extra obs error scaling_parameter_q 0.4163632 0.07121549 0.2977702</span></span>
<span><span class="co">#&gt; 3 M2: TMB extra obs error scaling_parameter_q 1.1272647 0.18618911 0.8155185</span></span>
<span><span class="co">#&gt; 4 M2: TMB extra obs error scaling_parameter_q 2.0421163 0.38749244 1.4078767</span></span>
<span><span class="co">#&gt; 5 M2: TMB extra obs error    extra_biomass_cv 0.5032296 0.12643787 0.2909269</span></span>
<span><span class="co">#&gt; 6 M2: TMB extra obs error       extra_cpue_cv 0.2544341 0.06124321 0.1555960</span></span>
<span><span class="co">#&gt;         uci</span></span>
<span><span class="co">#&gt; 1 0.2208214</span></span>
<span><span class="co">#&gt; 2 0.5821881</span></span>
<span><span class="co">#&gt; 3 1.5581812</span></span>
<span><span class="co">#&gt; 4 2.9620769</span></span>
<span><span class="co">#&gt; 5 0.7715900</span></span>
<span><span class="co">#&gt; 6 0.3974934</span></span></code></pre></div>
<p>A comparison of the the three models shows that estimation of
additional observation error substantially reduces PE variance,
resulting in a smoother trajectory of biomass predictions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_rema_models.html">compare_rema_models</a></span><span class="op">(</span>rema_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span>,</span>
<span>                               admb_re <span class="op">=</span> <span class="va">admb_re</span>,</span>
<span>                               biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>,</span>
<span>                               cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span><span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/compare-new-1.png" width="816"></p>
</div>
<div class="section level3">
<h3 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h3>
<p>Next, we can compare the fits to both biomass and CPUE survey indices
from the alternative TMB models if we remove the <code>admb_re</code>
object from the comparison function as demonstrated below. An
examination of the parameter estimates shows that the M2 (extra
observation error) estimates a much lower PE, approximately 50% of the
M1 PE. Using AIC, we find that M2 has a superior fit to M1 and that
there is statistical support for the additional parameters (note that
this example is intended to be illustrative of the model fitting and
model selection process and is not exhaustive).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_rema_models.html">compare_rema_models</a></span><span class="op">(</span>rema_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span>,</span>
<span>                               biomass_ylab <span class="op">=</span> <span class="st">'Biomass (t)'</span>,</span>
<span>                               cpue_ylab <span class="op">=</span> <span class="st">'Relative Population Weights'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">biomass_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'top'</span><span class="op">)</span>,</span>
<span>                   <span class="va">compare</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">cpue_by_strata</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span>,</span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.65</span>, <span class="fl">0.35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex2_cpue_files/figure-html/compare-new2-1.png" width="816"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">parameter_estimates</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="28%">
<col width="23%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">model_name</th>
<th align="left">parameter</th>
<th align="right">estimate</th>
<th align="right">std_err</th>
<th align="right">lci</th>
<th align="right">uci</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M1: TMB status quo</td>
<td align="left">process_error</td>
<td align="right">0.1696942</td>
<td align="right">0.0391459</td>
<td align="right">0.1079711</td>
<td align="right">0.2667020</td>
</tr>
<tr class="even">
<td align="left">M1: TMB status quo</td>
<td align="left">scaling_parameter_q</td>
<td align="right">0.4123883</td>
<td align="right">0.0447459</td>
<td align="right">0.3333860</td>
<td align="right">0.5101118</td>
</tr>
<tr class="odd">
<td align="left">M1: TMB status quo</td>
<td align="left">scaling_parameter_q</td>
<td align="right">1.2127879</td>
<td align="right">0.1087471</td>
<td align="right">1.0173260</td>
<td align="right">1.4458046</td>
</tr>
<tr class="even">
<td align="left">M1: TMB status quo</td>
<td align="left">scaling_parameter_q</td>
<td align="right">2.1164267</td>
<td align="right">0.3046949</td>
<td align="right">1.5960945</td>
<td align="right">2.8063890</td>
</tr>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="left">process_error</td>
<td align="right">0.0811985</td>
<td align="right">0.0414475</td>
<td align="right">0.0298576</td>
<td align="right">0.2208214</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="left">scaling_parameter_q</td>
<td align="right">0.4163632</td>
<td align="right">0.0712155</td>
<td align="right">0.2977702</td>
<td align="right">0.5821881</td>
</tr>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="left">scaling_parameter_q</td>
<td align="right">1.1272647</td>
<td align="right">0.1861891</td>
<td align="right">0.8155185</td>
<td align="right">1.5581812</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="left">scaling_parameter_q</td>
<td align="right">2.0421163</td>
<td align="right">0.3874924</td>
<td align="right">1.4078767</td>
<td align="right">2.9620769</td>
</tr>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="left">extra_biomass_cv</td>
<td align="right">0.5032296</td>
<td align="right">0.1264379</td>
<td align="right">0.2909269</td>
<td align="right">0.7715900</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="left">extra_cpue_cv</td>
<td align="right">0.2544341</td>
<td align="right">0.0612432</td>
<td align="right">0.1555960</td>
<td align="right">0.3974934</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">aic</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="33%">
<col width="26%">
<col width="18%">
<col width="8%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">model_name</th>
<th align="right">objective_function</th>
<th align="right">n_parameters</th>
<th align="right">aic</th>
<th align="right">delta_aic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M2: TMB extra obs error</td>
<td align="right">72.88938</td>
<td align="right">6</td>
<td align="right">157.8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">M1: TMB status quo</td>
<td align="right">87.89311</td>
<td align="right">4</td>
<td align="right">183.8</td>
<td align="right">26</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="apportionment-results">Apportionment results<a class="anchor" aria-label="anchor" href="#apportionment-results"></a>
</h3>
<p>The proportion of prediction biomass by strata (management area in
this example), is often used for apportionment of Acceptable Biological
Catch estimates. Results from the <code><a href="../reference/compare_rema_models.html">compare_rema_models()</a></code>
function include a table of proportioned biomass by management area for
this purpose.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">proportion_biomass_by_strata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">model_name</th>
<th align="right">year</th>
<th align="right">CGOA</th>
<th align="right">EGOA</th>
<th align="right">WGOA</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M1: TMB status quo</td>
<td align="right">2022</td>
<td align="right">0.3861345</td>
<td align="right">0.5610156</td>
<td align="right">0.0528499</td>
</tr>
<tr class="even">
<td align="left">M2: TMB extra obs error</td>
<td align="right">2022</td>
<td align="right">0.4124545</td>
<td align="right">0.5229923</td>
<td align="right">0.0645532</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare$plots$proportion_biomass_by_strata # optional figure</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jane Sullivan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
